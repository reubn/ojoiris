(window.webpackJsonp=window.webpackJsonp||[]).push([[7],{554:function(e,t,i){e.exports=function(){return new Worker(i.p+"00dca3fc685d1a35ce3c.worker.js")}},555:function(e,t,i){"use strict";i.r(t),i.d(t,"default",function(){return n});var s=i(554),a=i.n(s);class n{static hasCamera(){return navigator.mediaDevices.enumerateDevices().then(e=>e.some(e=>"videoinput"===e.kind)).catch(()=>!1)}constructor(e,t,i=n.DEFAULT_CANVAS_SIZE){this.$video=e,this.$canvas=document.createElement("canvas"),this._onDecode=t,this._active=!1,this._paused=!1,this.$canvas.width=i,this.$canvas.height=i,this._sourceRect={x:0,y:0,width:i,height:i},this._onCanPlay=this._onCanPlay.bind(this),this._onPlay=this._onPlay.bind(this),this._onVisibilityChange=this._onVisibilityChange.bind(this),this.$video.addEventListener("canplay",this._onCanPlay),this.$video.addEventListener("play",this._onPlay),document.addEventListener("visibilitychange",this._onVisibilityChange),this._qrWorker=new a.a}destroy(){this.$video.removeEventListener("canplay",this._onCanPlay),this.$video.removeEventListener("play",this._onPlay),document.removeEventListener("visibilitychange",this._onVisibilityChange),this.stop(),this._qrWorker.postMessage({type:"close"})}start(){if(this._active&&!this._paused)return Promise.resolve();if("https:"!==window.location.protocol)return console.warn("The camera stream is only accessible if the page is transferred via https."),window.location=window.location.href.replace("http","https"),Promise.reject();if(this._active=!0,this._paused=!1,document.hidden)return Promise.resolve();if(clearTimeout(this._offTimeout),this._offTimeout=null,this.$video.srcObject)return this.$video.play(),Promise.resolve();let e="environment";return this._getCameraStream("environment",!0).catch(()=>(e="user",this._getCameraStream())).then(t=>{this.$video.srcObject=t,this._setVideoMirror(e)}).catch(e=>{throw this._active=!1,e})}stop(){this.pause(),this._active=!1}pause(){this._paused=!0,this._active&&(this.$video.pause(),this._offTimeout||(this._offTimeout=setTimeout(()=>{const e=this.$video.srcObject&&this.$video.srcObject.getTracks()[0];e&&(e.stop(),this.$video.srcObject=null,this._offTimeout=null)},300)))}static scanImage(e,t=null,i=null,s=null,r=!1,o=!1){let h=!1,c=new Promise((o,c)=>{let d,m,v;i||(i=new a.a,h=!0,i.postMessage({type:"inversionMode",data:"both"})),m=(e=>{"scan"===e.data.type&&(i.removeEventListener("message",m),i.removeEventListener("error",v),clearTimeout(d),o(e.data.result))}),v=(e=>{i.removeEventListener("message",m),i.removeEventListener("error",v),clearTimeout(d);const t=e?e.message||e:"Unknown Error";c("Scanner error: "+t)}),i.addEventListener("message",m),i.addEventListener("error",v),d=setTimeout(()=>v("timeout"),3e3),n._loadImage(e).then(e=>{const a=n._getImageData(e,t,s,r);i.postMessage({type:"decode",data:a},[a.data.buffer])}).catch(v)});return t&&o&&(c=c.catch(()=>n.scanImage(e,null,i,s,r))),c=c.finally(()=>{h&&i.postMessage({type:"close"})})}setGrayscaleWeights(e,t,i,s=!0){this._qrWorker.postMessage({type:"grayscaleWeights",data:{red:e,green:t,blue:i,useIntegerApproximation:s}})}setInversionMode(e){this._qrWorker.postMessage({type:"inversionMode",data:e})}_onCanPlay(){this._updateSourceRect(),this.$video.play()}_onPlay(){this._updateSourceRect(),this._scanFrame()}_onVisibilityChange(){document.hidden?this.pause():this._active&&this.start()}_updateSourceRect(){const e=Math.min(this.$video.videoWidth,this.$video.videoHeight),t=Math.round(2/3*e);this._sourceRect.width=this._sourceRect.height=t,this._sourceRect.x=(this.$video.videoWidth-t)/2,this._sourceRect.y=(this.$video.videoHeight-t)/2}_scanFrame(){if(!this._active||this.$video.paused||this.$video.ended)return!1;requestAnimationFrame(()=>{n.scanImage(this.$video,this._sourceRect,this._qrWorker,this.$canvas,!0).then(this._onDecode,e=>{this._active&&"QR code not found."!==e&&console.error(e)}).then(()=>this._scanFrame())})}_getCameraStream(e,t=!1){const i=[{width:{min:1024}},{width:{min:768}},{}];return e&&(t&&(e={exact:e}),i.forEach(t=>t.facingMode=e)),this._getMatchingCameraStream(i)}_getMatchingCameraStream(e){return 0===e.length?Promise.reject("Camera not found."):navigator.mediaDevices.getUserMedia({video:e.shift()}).catch(()=>this._getMatchingCameraStream(e))}_setVideoMirror(e){const t="user"===e?-1:1;this.$video.style.transform="scaleX("+t+")"}static _getImageData(e,t=null,i=null,s=!1){i=i||document.createElement("canvas");const a=t&&t.x?t.x:0,n=t&&t.y?t.y:0,r=t&&t.width?t.width:e.width||e.videoWidth,o=t&&t.height?t.height:e.height||e.videoHeight;s||i.width===r&&i.height===o||(i.width=r,i.height=o);const h=i.getContext("2d",{alpha:!1});return h.imageSmoothingEnabled=!1,h.drawImage(e,a,n,r,o,0,0,i.width,i.height),h.getImageData(0,0,i.width,i.height)}static _loadImage(e){if(e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||window.ImageBitmap&&e instanceof window.ImageBitmap||window.OffscreenCanvas&&e instanceof window.OffscreenCanvas)return Promise.resolve(e);if(e instanceof Image)return n._awaitImageLoad(e).then(()=>e);if(e instanceof File||e instanceof URL||"string"==typeof e){const t=new Image;return e instanceof File?t.src=URL.createObjectURL(e):t.src=e,n._awaitImageLoad(t).then(()=>(e instanceof File&&URL.revokeObjectURL(t.src),t))}return Promise.reject("Unsupported image type.")}static _awaitImageLoad(e){return new Promise((t,i)=>{if(e.complete&&0!==e.naturalWidth)t();else{let s,a;s=(()=>{e.removeEventListener("load",s),e.removeEventListener("error",a),t()}),a=(()=>{e.removeEventListener("load",s),e.removeEventListener("error",a),i("Image load error")}),e.addEventListener("load",s),e.addEventListener("error",a)}})}}n.DEFAULT_CANVAS_SIZE=400,n.WORKER_PATH="qr-scanner-worker.min.js"}}]);